{% extends "base_generic.html" %}
{% load static %}
{% block title %}Tournaments{% endblock %}

{% block content %}
<style>
    :root {
        --surface-color: #fff;
        --curve: 40;
    }

    * {
        box-sizing: border-box;
    }

    body {
        font-family: 'Noto Sans JP', sans-serif;
        background-color: #fef8f8;
    }

    .cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
        gap: 7.5rem;
        margin: 4rem 5vw;
        padding: 0;
        list-style-type: none;
    }

    @media (min-width: 768px) {
        .cards {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    .card {
        position: relative;
        display: block;
        height: 130%;
        width: 150%;
        border-radius: calc(var(--curve) * 1px);
        overflow: hidden;
        text-decoration: none;
        background-color: var(--surface-color);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s, box-shadow 0.3s;
    }

    .card:hover {
        transform: translateY(-10px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    .card__image {
        width: 100%;
        height: 200px;
        object-fit: cover;
    }

    .card__overlay {
        position: absolute;
        text-align: center;
        bottom: -10px;
        left: -40px;
        right: -40px    ;
        z-index: 1;
        border-radius: calc(var(--curve) * 1px);
        background-color: var(--surface-color);
        transform: translateY(100%);
        transition: 0.2s ease-in-out;
        padding: 20px;
    }

    .card:hover .card__overlay {
        transform: translateY(0);
    }

    .card__header {
        position: relative;
        display: flex;
        align-items: center;
        gap: 2em;
        padding: 2em;
        border-radius: calc(var(--curve) * 1px) 0 0 0;
        background-color: var(--surface-color);
        transform: translateY(-100%);
        transition: 0.2s ease-in-out;
    }

    .card__arc {
        width: 80px;
        height: 80px;
        position: absolute;
        bottom: 100%;
        right: 0;
        z-index: 1;
    }

    .card__arc path {
        fill: var(--surface-color);
    }

    .card:hover .card__header {
        transform: translateY(0);
    }

    .card__thumb {
        flex-shrink: 0;
        width: 50px;
        height: 50px;
        border-radius: 50%;
    }

    .card__title {
        font-size: 1.7em;
        margin: 0;
        color: #6A515E;
    }

    .card__description {
        color: #D7BDCA;
        font-size: 1.3em;
    }

    .card__description strong {
        display: block;
        color: #6A515E;
    }

    .card__description .btn {
        display: block;
        width: 100%;
        text-align: center;
        margin-top: 10px;
    }

    .sort-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .sort-container label {
        margin-right: 10px;
    }

    .form-inline {
        display: flex;
        align-items: center;
    }
</style>

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="mt-4 mb-3">Tournaments</h1>
    {% if user.is_authenticated %}
    <div class="text-right">
        <a href="{% url 'game_mode_selection' %}" class="btn btn-success">Create Tournament</a>
    </div>
    {% endif %}
</div>

<div class="sort-container mb-3">
    <div class="form-inline">
        <label for="sort" class="mr-2">Sort by:</label>
        <select id="sort" class="form-control" onchange="sortTournaments()">
            <option value="name">Tournament Name</option>
            <option value="date">Date</option>
            <option value="host">Host Name</option>
            <option value="gamemode">Game Mode</option>
        </select>
    </div>
    <div class="form-inline ml-3">
        <input type="text" id="search" class="form-control" placeholder="Search Tournaments..." onkeyup="searchTournaments()">
    </div>
</div>

<ul class="cards" id="tournament-container">
    {% for tournament in tournaments %}
    <li class="card tournament-card" data-name="{{ tournament.name }}" data-date="{{ tournament.date }}" data-host="{{ tournament.created_by.username }}">
        {% if tournament.image %}
            <img src="{{ tournament.image.url }}" class="card__image" alt="{{ tournament.name }}">
        {% else %}
            <img src="{% static 'tournament_app/images/robot.png' %}" class="card__image" alt="No Image Available">
        {% endif %}
        <div class="card__overlay">
            <div class="card__header">
                <svg class="card__arc" xmlns="http://www.w3.org/2000/svg"><path /></svg>
                <div class="card__title">{{ tournament.name }}</div>
            </div>
            <div class="card__description">
                <strong>Host:</strong> {{ tournament.created_by }}
                <strong>Date:</strong> {{ tournament.date }}
                <strong>Location:</strong> {{ tournament.location }}
                <a href="{% url 'tournament_detail' tournament.id %}" class="btn btn-primary">View Details</a>
            </div>
        </div>
    </li>
    {% endfor %}
</ul>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const cards = document.querySelectorAll('.tournament-card');
        cards.forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
        });
    });

    function sortTournaments() {
        const container = document.getElementById('tournament-container');
        const cards = Array.from(container.getElementsByClassName('tournament-card'));
        const sortBy = document.getElementById('sort').value;

        cards.sort((a, b) => {
            let aValue, bValue;
            if (sortBy === 'date') {
                aValue = new Date(a.getAttribute('data-date'));
                bValue = new Date(b.getAttribute('data-date'));
            } else if (sortBy === 'name') {
                aValue = a.getAttribute('data-name').toLowerCase();
                bValue = b.getAttribute('data-name').toLowerCase();
            } else if (sortBy === 'host') {
                aValue = a.getAttribute('data-host').toLowerCase();
                bValue = b.getAttribute('data-host').toLowerCase();
            } else if (sortBy === 'gamemode') {
                aValue = a.getAttribute('data-gamemode').toLowerCase();
                bValue = b.getAttribute('data-gamemode').toLowerCase();
            }

            if (aValue < bValue) return -1;
            if (aValue > bValue) return 1;
            return 0;
        });

        cards.forEach(card => container.appendChild(card));
    }

    function searchTournaments() {
        const searchInput = document.getElementById('search').value.toLowerCase();
        const cards = document.querySelectorAll('.tournament-card');

        cards.forEach(card => {
            const name = card.getAttribute('data-name').toLowerCase();
            if (name.includes(searchInput)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }
</script>
{% endblock %}
